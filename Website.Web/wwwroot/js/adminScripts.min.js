function validateAndSubmitJson(){var r=$("#edit-form").validate().valid(),i,n,t;r&&(i=$("#edit-form").serializeArray(),n=i.reduce((n,t)=>(n[t.name]=t.value,n),{}),n.Price=n.Price.replace(",","."),n.Images=getImagesFromContainer($("div#image-container")[0]),console.log(n),t=JSON.stringify(n),console.log(t),console.log("sending json"),$.ajax({type:"POST",url:"/Admin/EditItem",headers:{RequestVerificationToken:n.__RequestVerificationToken,"Content-Type":"application/json"},data:t,success:function(n){$("div#admin-content").html(n);$.validator.unobtrusive.parse("form#edit-form")},error:function(n){var t=$("div.validation-summary-valid>ul>li")[0];t.removeAttribute("style");t.innerText=n.status===400?n.responseText:"Возникла ошибка при отправке запроса серверу."},async:!0}))}function getImagesFromContainer(n){var r,u,t,i;if(n!==undefined){for(r=[],u=n.children,t=0;t<u.length;t++)i=u[t],r[t]={Id:i.dataset.id,Primary:i.classList.contains("img-primary"),PendingDel:i.classList.contains("img-delete"),PendingAdd:i.classList.contains("img-add")},r[t].PendingAdd?r[t].UriBase64Data=i.src:(r[t].Path=i.dataset.path,r[t].ThumbPath=i.src);return r}}function getImgId(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function setPrimaryImage(){var r=$("img.admin-img-thumb"),t,i,n;r.length!==0&&(t=$("img#admin-image-view")[0],i=t.dataset.id,$(".img-primary").each((n,t)=>{t.classList.remove("img-primary")}),n=$("[data-id="+i+"]")[1],n.classList.add("img-primary"),n.classList.remove("img-delete"),setImage(n))}function setDeleteImage(){var t=$("img.admin-img-thumb"),r,f,u;if(t.length!==0){var i=$("img#admin-image-view")[0],e=i.dataset.id,n=$("[data-id="+e+"]")[1];if(n.classList.contains("img-delete"))n.classList.remove("img-delete"),i.classList.remove("img-delete"),checkExistingPrimaries()||(n.classList.add("img-primary"),i.classList.add("img-primary"));else if(r=n.classList.contains("img-add"),r?(n.remove(),$("#file-upload-button")[0].form.reset(),f=$("img.admin-img-thumb"),f.length===0?$("img#admin-image-view")[0].src="":setImage($(".img-primary")[0])):(n.classList.add("img-delete"),i.classList.add("img-delete")),n.classList.contains("img-primary")){for(n.classList.remove("img-primary"),i.classList.remove("img-primary"),u=0,t=$("img.admin-img-thumb"),n=t[u++];n.classList.contains("img-delete")&&t.length>u;)n=t[u++];if(n.classList.contains("img-delete")){r&&setImage(t[0]);return}n.classList.add("img-primary");r&&setImage(n)}}}function checkExistingPrimaries(){var n=!1;return $("img.admin-img-thumb").each((t,i)=>{i.classList.contains("img-primary")&&(n=!0)}),n}function isImage(n){return n instanceof HTMLImageElement}function setImage(n){var t,r,i;t=isImage(n)?n:n.target;r=t.src;i=$("img#admin-image-view")[0];t.src.substring(0,10)!=="data:image"&&(r=t.dataset.path);i.src=r;i.dataset.id=t.dataset.id;t.classList.contains("img-primary")?i.classList.add("img-primary"):i.classList.remove("img-primary");t.classList.contains("img-delete")?i.classList.add("img-delete"):i.classList.remove("img-delete")}$(document).on("click","img.admin-img-thumb",setImage);$(document).on("click","#image-primary-button",setPrimaryImage);$(document).on("click","#image-remove-button",setDeleteImage);$(document).ready(()=>{$("#file-upload-button").on("change",function(){var f=$(this)[0].files.length,r=$(this)[0].value,n=r.substring(r.lastIndexOf(".")+1).toLowerCase(),u=$("#image-container"),t,i;if(n==="gif"||n==="png"||n==="jpg"||n==="jpeg")if(typeof FileReader!==undefined)for(t=0;t<f;t++)i=new FileReader,i.onload=function(n){var t="admin-img-thumb img-add",i=!checkExistingPrimaries(),r;i&&(t=t+" img-primary");$("<img />",{"class":t,click:setImage,"data-id":Math.floor(Math.random()*1e7+1e7),src:n.target.result}).appendTo(u);i&&(r=$("img.admin-img-thumb.img-add")[0],setImage(r))},u.show(),i.readAsDataURL($(this)[0].files[t]);else alert("Браузер не поддерживает загрузку картинок.");else alert("Выберите изображения.")})});$(document).ready(function(){$("#role-selector").change(function(){$(this).val()==="admin"?$(".admin-options").removeClass("hidden"):$(".admin-options").addClass("hidden")})});$(".admin-options label").click(function(){var n=this.className.split(" "),t=n[0],i=n[1];$("."+t+"."+i+":checkbox").click()});$(".admin-options input:checkbox, .admin-options label").click(function(){var i=this.className.split(" "),t=i[0],n=i[1];t==="delete"&&this.checked===!0?($(".view."+n+":checkbox").prop("checked",!0).prop("disabled",!0),$(".edit."+n+":checkbox").prop("checked",!0).prop("disabled",!0),$(".create."+n+":checkbox").prop("checked",!0).prop("disabled",!0)):t==="delete"&&this.checked===!1?($(".view."+n+":checkbox").prop("checked",!1).prop("disabled",!1),$(".edit."+n+":checkbox").prop("checked",!1).prop("disabled",!1),$(".create."+n+":checkbox").prop("checked",!1).prop("disabled",!1)):t==="create"&&this.checked===!0?($(".view."+n+":checkbox").prop("checked",!0).prop("disabled",!0),$(".edit."+n+":checkbox").prop("checked",!0).prop("disabled",!0)):t==="create"&&this.checked===!1?($(".view."+n+":checkbox").prop("checked",!1).prop("disabled",!1),$(".edit."+n+":checkbox").prop("checked",!1).prop("disabled",!1)):t==="edit"&&this.checked===!0?$(".view."+n+":checkbox").prop("checked",!0).prop("disabled",!0):t==="edit"&&this.checked===!1&&$(".view."+n+":checkbox").prop("checked",!1).prop("disabled",!1)});